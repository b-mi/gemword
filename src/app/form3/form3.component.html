<div class="app-layout">
  
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2>Nastavenia úprav</h2>
    </div>

    <div class="settings-list">
      @for (opt of switches; track opt.value) {
        <label class="checkbox-item" [class.active]="opt.checked">
          <input type="checkbox" 
                 [checked]="opt.checked" 
                 (change)="toggleSwitch(opt)">
          <span>{{ opt.label }}</span>
        </label>
      }
    </div>

    <div class="instruction-box">
      <label>Ďalšie Inštrukcie</label>
      <textarea 
        [ngModel]="customInstruction()" 
        (ngModelChange)="customInstruction.set($event)"
        placeholder="napr. 'pre dieťa v 5. triede'">
      </textarea>
    </div>

    <button class="btn-primary" (click)="handleGenerate()" [disabled]="isLoading()">
      @if (isLoading()) {
        <span aria-busy="true">Generujem...</span>
      } @else {
        <i class="bi bi-stars"></i> Vylepšiť Text
      }
    </button>

    @if (error()) {
      <div class="error-msg">{{ error() }}</div>
    }
  </aside>

  <main class="main-content">
    <header>
      <h1>Editor textu s AI Gemini</h1>
      <p>Oprava preklepov, diakritiky a štylizácia</p>
    </header>

    <div class="editor-grid">
      
      <div class="card input-area">
        <div class="card-header">
          <span>Input</span>
          <div class="header-actions">
            <button (click)="handlePaste()" title="Prilepiť" class="icon-btn"><i class="bi bi-clipboard"></i></button>
            <button (click)="handleClear()" title="Vymazať" class="icon-btn"><i class="bi bi-trash"></i></button>
          </div>
        </div>
        <textarea 
          [ngModel]="inputText()" 
          (ngModelChange)="inputText.set($event)"
          placeholder="Sem vložte text na úpravu..."></textarea>
      </div>

      <div class="card output-area">
        <div class="card-header">
          <span>Raw (Markdown)</span>
          <div class="header-actions">
            <button (click)="copyAsRawText()" title="Kopírovať" class="icon-btn"><i class="bi bi-copy"></i></button>
          </div>
        </div>
        <textarea readonly [value]="rawOutput()" placeholder="Tu sa objaví výsledok..."></textarea>
      </div>

      <div class="card preview-area">
        <div class="card-header">
          <span>HTML Preview</span>
          <div class="header-actions">
             <button (click)="copyAsHtml(previewRef.innerHTML)" title="Kopírovať HTML" class="icon-btn"><i class="bi bi-code-slash"></i></button>
          </div>
        </div>
        <div class="preview-content" #previewRef [innerHTML]="previewHtml()"></div>
      </div>

    </div>
  </main>
</div>